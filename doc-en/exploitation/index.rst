============
Exploitation
============

Centreon-esxd Presentation
---------------------------

Generals Principles
```````````````````

Centreon-esxd is a Perl program in charged to get back VMWare indicators. This program uses the SDK Perl provided by VMWare in order to connect and get back the informations of one (or more) Virtual Center. To do this, it makes a TCP connection with the VirtualCenter.

By default "centreon-esxd" starts at least two processes (named "handle-client" and "handle-vsphere-xxxx") :

*« handle-client »*:
  *Process waiting for requests of "centron-esx-client.pl" clients.*

Steps of operation :

- A client connects.
- The client ask an monitoring indicator on a VirtualCenter.
- The process "handle-client" sends the request to process "handle-vsphere-xxxx".
- A response is sent by "handle-vsphere-xxxx" to "handle-client".
- The process "handle-client" sends the response to the client.

*« handle-vsphere-xxxx »*:
  *Process responsible to connect and to keep opened a session with the VirtualCenter. To ensure quality performance, a cache of datas description is created.*

Then, this process gets back the VMWare indicators creating a subprocess per request.

Centreon-esxd necessitates the utilization of one (or more) VirtualCenter. It isn't possible to get back informations of an ESX server directly.

This is a example of a fragmented architecture :

.. image:: ../images/archi.png

Operating mode
``````````````
The "centreon-esxd" program only works in "daemon" mode. (dans le sens où il ne peut fournir les indicateurs sans l'utilisation d'un client).

Lors de l'utilisation du plugin *centreon_esx_client.pl*, on passe des chaînes de caractères qui vont être lier aux différentes librairies dans *"/usr/share/centreon/lib/centreon-esxd"* et qui va être ensuite communiquer au Vcenter qui va au final retourner le résultat au Client. Le client ouvre une liaison TCP avec le serveur pour récolter les informations nécessaires. 

Configuration du connecteur
```````````````````````````
Le daemon « centreon-esxd » possède un fichier de configuration « centreon_esxd.pm » de la forme suivante ::
 
  our $libpath = '/usr/share/centreon/lib/centreon-esxd';
  our $port = 5700;
  our %vsphere_server = ('default' => {'url' => 'https://XXXXXX/sdk',
                                     'username' => 'XXXXX',
                                     'password' => 'XXXXX'},
                       'testvc' =>  {'url' => 'https://XXXXXX/sdk',
                                     'username' => 'XXXXX',
                                     'password' => 'XXXXXX'}
  our $TIMEOUT_VSPHERE = 60;
  our $TIMEOUT = 60;
  our $TIMEOUT_KILL = 30;
  our $REFRESH_KEEPER_SESSION = 15;
  # Log Mode: 0 = stdout, 1 = file, 2 = syslog
  our $log_mode = 1;
  # Criticity: 0 = nothing, 1 = critical, 3 = info
  our $log_crit = 1;
  # Specify if $log_mode = 2 and CPAN Module Unix::Syslog is installed
  our $log_facility;
  #our $log_facility = LOG_DAEMON;
  our $LOG = "/tmp/centreon_esxd.log";

La variable «%vsphere_server » permet de configurer les accès aux différents VirtualCenter. Il est nécessaire d'avoir au moins l'entrée 'default'.

La variable « $port » permet de configurer le port d'écoute du connecteur « centreon-esxd ».

Il est aussi possible de modifier la variable « $log_mode » si vous souhaitez utiliser « syslog » au lieu d'un fichier à plat.

Il est déconseillé de modifier les variables suivantes : « $REFRESH_KEEPER_SESSION », « $TIMEOUT_KILL », « $ TIMEOUT_VSPHERE » et « $TIMEOUT », car ils sont configurés pour une utilisation optimale.


Optimisation de la configuration dans Centreon
----------------------------------------------

Afin d'exploiter pleinement « centreon-esxd », il est recommandé d'effectuer une série d'action préalablement.

Ce connecteur permet la définition de trois modèles d'hôtes :

- le modèle hôte « VMWare-VM » : modèle d'une machine virtuelle.
- le modèle hôte « VMWare-ESX » : modèle d'un serveur ESX.
- le modèle hôte « VMWare-VC » : modèle d'un virtualCenter (Ce modèle contient notamment des services pour les « datastores »)

Tous les plugins de contrôle VMWare ont quelques attributs en commun, qui peuvent être défini dans des modèles afin de simplifier la configuration.

+--------------------+-------------------------------------------------------------------+----------------------------------------------------------------+
| Macro Name         | Macro Value                                                       | Ressource ou la macro doit être défini (recommandé)            |
|                    |                                                                   |                                                                |
+====================+===================================================================+================================================================+
| HOSTESXDHOST       | Ip ou nom d'hôte du serveur exécutant le daemon « centreon-esxd » | Modèle d'hôte VMWare-* de plus bas niveau                      |   
+--------------------+-------------------------------------------------------------------+----------------------------------------------------------------+
| HOSTESXDPORT       | Port du daemon                                                    | Modèle d'hôte VMWare-* de plus bas niveau                      |
+--------------------+-------------------------------------------------------------------+----------------------------------------------------------------+ 
| HOSTVCNAME         | Nom identifiant le VirtualCenter                                  | Modèle d'hôte VMWare-* de plus bas niveau                      |
+--------------------+-------------------------------------------------------------------+----------------------------------------------------------------+

Le login et le mot de passe du VirtualCenter se situe directement dans le fichier de configuration « centreon_esxd.pm » qui se situe normalement dans "*/etc/centreon/centreon_esxd.pm*" . Ce système évite la visualisation d'un mot de passe dans l'interface « centreon ».


Création d'un modèle d'hôte VMWare générique
````````````````````````````````````````````

Aller dans le menu configuration/host/template/, et créer un modèle d'hôte « VMWare ». Ce modèle d'hôte sera le modèle parent pour les modèles « VMWare-VM », « VMWare-ESX » et « VMWare-VC ».

Configurer l'ensemble des champs comme indiqué dans la documentation Centreon.

Définir les macros suivante :

+---------------------+-------------------------------------------------------------------+
| Macro Name          | Macro Value                                                       |
|                     |                                                                   |
+=====================+===================================================================+
| ESXDHOST            | Exemple: 10.30.10.30                                              |
+---------------------+-------------------------------------------------------------------+
| ESXDPORT            | 5700 (port par défaut)                                            |
+---------------------+-------------------------------------------------------------------+
| VCNAME              | default                                                           |
+---------------------+-------------------------------------------------------------------+

Troubleshooting
```````````````

Il est possible de retrouver des erreurs de ce type dans les « log » de « centreon-esxd » ::

 ...SOAP request error - possibly a protocol issue: read failed: error:1408F119:SSL routines:SSL3_GET_RECORD:decryption failed or bad record mac...

Le SDK Perl VMWare génère cette erreur de temps en temps mais ne bloque pas le fonctionnement du connecteur.

Il est nécessaire de remonter un problème dans le cas d'un trop grand nombres de déconnexion du daemon au VirtualCenter.


Liste des contrôles
-------------------

Contrôles ESX
`````````````
CPU
'''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_cpuhost                                                                                                                      | 
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation CPU d'un serveur ESX. Le nombre de métrique renvoyé dépend du nombre de CPUs.                                       |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « cpu_total » est en dessous du seuil WARNING.                                                                |
|                            |  - Remonte un état WARNING si la métrique « cpu_total » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                            |
|                            |  - Remonte un état CRITICAL si la métrique « cpu_total » est au dessus du seuil CRITICAL.                                                          |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | cpu_total=17.87%;10;90;0;100 cpu0=10.38%;;0;100 cpu1=8.66%;;0;100 cpu2=9.45%;;0;100 cpu3=8.91%;;0;100                                              |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                  | Description                                                         | Exemple             				           |
|                           |                                                                     |                                                                |
+===========================+=====================================================================+================================================================+
| -u                        | Indicateur à contrôler                                              |  cpuhost				                           |
+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\   | Nom du serveur ESX ciblé                                            |  esx1.test.fr	                                           |
+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\    | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\   | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--light-perfdata``\   | (optionnel) Permet d'afficher uniquement la perfdata du CPU total   |                                                                |
+---------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).

Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u cpuhost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$


L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


MEMOIRE
'''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_memhost                                                                                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation mémoire d'un serveur ESX. 3 métriques sont renvoyés :                                                               |
|                            |  - le taux d'utilisation mémoire (en octets),                                                                                                      |
|                            |  - la taille totale de la mémoire (en octets),                                                                                                     |
|                            |  - la mémoire suralloué par la totalité des VMs ('overhead' en octets)                                                                             |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « used » est en dessous du seuil WARNING.                                                                     |
|                            |  - Remonte un état WARNING si la métrique « used » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                 |
|                            |  - Remonte un état CRITICAL si la métrique « used » est au dessus du seuil CRITICAL.                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | used=56196403200o;6870586573;61835279155;0;68705865728 size=68705865728o overhead=1773761536o                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/5                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                 | Description                                                         | Exemple                                                        |
|                          |                                                                     |                                                                |
+==========================+=====================================================================+================================================================+
| -u                       | Indicateur à contrôler                                              |  memhost                                                       |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\  | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\   | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\  | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u memhost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$


L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


RESEAU
''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_nethost                                                                                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation d'une interface réseau physique d'un serveur ESX. 2 métriques sont renvoyés :                                       |
|                            |  - le taux d'utilisation en entrée et sortie (en b/s).                                                                                             |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la(les) métrique(s) « traffic_* » est(sont) en dessous du seuil WARNING.                                                  |
|                            |  - Remonte un état WARNING si la(les) métrique(s) « traffic_* » est(sont) en dessous du seuil CRITICAL et au dessus du seuil WARNING.              |
|                            |  - Remonte un état CRITICAL si la(les) métrique(s) « traffic_* » est(sont) au dessus du seuil CRITICAL.                                            |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | traffic_in=598016b/s traffic_out=172032b/s                                                                                                         |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                 | Description                                                         | Exemple                                                        |
|                          |                                                                     |                                                                |
+==========================+=====================================================================+================================================================+
| -u                       | Indicateur à contrôler                                              |  nethost                                                       |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\  | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--nic``\             | Nom de l'interface réseau physique                                  | vmnic0                                                         |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\   | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\  | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| NICNAME             |                                |
+---------------------+--------------------------------+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u nethost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$ --nic "$_SERVICENICNAME$"

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.

SWAP
''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_swaphost                                                                                                                     |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation mémoire d'un serveur ESX. 2 métriques sont renvoyés :                                                               |
|                            |  - le taux de lecture et d'écriture du swap globale de l'ensemble des machines virtuelles (en Mb/s).                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la(les) métrique(s) « swap_* » est(sont) en dessous du seuil WARNING.                                                     |
|                            |  - Remonte un état WARNING si la(les) métrique(s) « swap_* » est(sont) en dessous du seuil CRITICAL et au dessus du seuil WARNING.                 |
|                            |  - Remonte un état CRITICAL si la(les) métrique(s) « swap_* » est(sont) au dessus du seuil CRITICAL.                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | swap_in=0b/s swap_out=0b/s                                                                                                                         |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/5                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  swaphost                                                      |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\  | (optionnel – Défaut : 0.8) Seuil warning en MB/s                    |  0.5                                                           |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\ | (optionnel – Défaut : 1) Seuil critique en MB/s                     |  1.5                                                           |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 0.8                            |
+---------------------+--------------------------------+
| CRITICAL            | 1                              |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u swaphost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.

DATASTORES
''''''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_datastoreshost                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation d'une interface réseau physique d'un serveur ESX. 2 métriques sont renvoyés par le datastore :                      |
|                            |  - la latence totale en lecture et écriture (en ms).                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la(les) métrique(s) est(sont) en dessous du seuil WARNING.                                                                |
|                            |  - Remonte un état WARNING si la(les) métrique(s) est(sont) en dessous du seuil CRITICAL et au dessus du seuil WARNING.                            |
|                            |  - Remonte un état CRITICAL si la(les) métrique(s) est(sont) au dessus du seuil CRITICAL.                                                          |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | 'trl_LUN1'=0.00ms 'twl_LUN1'=0.00ms 'trl_LUN2'=0.00ms 'twl_LUN2'=1.00ms                                                                            |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                   | Description                                                                        | Exemple                                                        |
|                            |                                                                                    |                                                                |
+============================+====================================================================================+================================================================+
| -u                         | Indicateur à contrôler                                                             |  datastoreshost                                                |
+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\    | Nom du serveur ESX ciblé                                                           |  esx1.test.fr                                                  |
+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--filter-datastores``\ | (optionnel) Permet de filtrer les datastores à traiter (séparé par des virgules)   | LUN1,LUN2                                                      |
+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\     | (optionnel – Défaut : aucunes) Seuil warning en ms                                 |  75                                                            |
+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\    | (optionnel – Défaut : aucunes) Seuil critique en ms                                |  90                                                            |
+----------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................


Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 30                             |
+---------------------+--------------------------------+
| CRITICAL            | 50                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u datastoreshost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


COUNTVM
'''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_countvmhost                                                                                                                  |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation mémoire d'un serveur ESX. 1 métrique est remontée :                                                                 |
|                            |  - le nombre de machines virtuelles allumées.                                                                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « count » est en dessous du seuil WARNING.                                                                    |
|                            |  - Remonte un état WARNING si la métrique « count » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                |
|                            |  - Remonte un état CRITICAL si la métrique « count » est au dessus du seuil CRITICAL.                                                              |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | count=45                                                                                                                                           |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/5                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  countvmhost                                                   |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\  | (optionnel – Défaut : aucunes valeurs) Seuil warning en ms          |  10                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\ | (optionnel – Défaut : aucunes valeurs) Seuil critique en ms         |  15                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 10                             |
+---------------------+--------------------------------+
| CRITICAL            | 15                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u countvmhost --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


HEALTH
''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_healthhost                                                                                                                   |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle l'état des sondes matériels et processeurs d'un serveur ESX.                                                                              |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  Remonte un état selon l'état des sondes:                                                                                                          |
|                            |     - "Yellow" correspond à WARNING.                                                                                                               |
|                            |     - "Red" correspond à CRITICAL.                                                                                                                 |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    |                                                                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 30/1                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  healthhost                                                    |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
|                     |                                |
+---------------------+--------------------------------+
|                     |                                |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u healthhost

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


MAINTENANCE
'''''''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_maintenancehost                                                                                                              |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le mode de maintenance d'un serveur ESX.                                                                                                  |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte l'état « CRITICAL » si le serveur ESX est en mode de maintenance.                                                                       |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    |                                                                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 30/1                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  maintenancehost                                               |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
|                     |                                |
+---------------------+--------------------------------+
|                     |                                |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u maintenancehost

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


STATUT
''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_statushost                                                                                                                   |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle l'état global d'un serveur ESX.                                                                                                           |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte l'état « CRITICAL » si le statut du serveur ESX est en « red » .                                                                        |
|                            |  - Remonte l'état « WARNING » si le statut du serveur ESX est en « yellow » .                                                                      | 
|                            |  - Remonte l'état « UNKNOWN » si le statut du serveur ESX est en « gray » .                                                                        |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    |                                                                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 30/1                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  statushost                                                    |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du serveur ESX ciblé                                            |  esx1.test.fr                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
|                     |                                |
+---------------------+--------------------------------+
|                     |                                |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" -e "$HOSTADDRESS$" -u statushost

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


Contrôles d'une machine virtuelle
`````````````````````````````````

CPU
'''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_cpuvm                                                                                                                        |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation CPU d'une machine virtuelle. Le nombre de métrique renvoyé dépend du nombre de CPUs.                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « cpu_total » est en dessous du seuil WARNING.                                                                |
|                            |  - Remonte un état WARNING si la métrique « cpu_total » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                            |
|                            |  - Remonte un état CRITICAL si la métrique « cpu_total » est au dessus du seuil CRITICAL.                                                          |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | cpu_total=0.22%;80;90;0;100 cpu_total_MHz=5.00MHz cpu0_MHz=2.00MHz                                                                                 |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                 | Description                                                         | Exemple                                                        |
|                          |                                                                     |                                                                |
+==========================+=====================================================================+================================================================+
| -u                       | Indicateur à contrôler                                              |  cpuvm                                                         |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--vm``\              | Nom de la machine virtuelle ciblée                                  |  myvmname                                                      |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\   | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\  | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+--------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).

Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --vm "$HOSTADDRESS$" -u cpuvm --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


MEMOIRE
'''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_memvm                                                                                                                        |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation mémoire d'une machine virtuelle. 6 métriques sont renvoyés :                                                        |
|                            |     - « used » : la taille mémoire occupée par la machine virtuelle sur le serveur physique (en octets)                                            |
|                            |     - « size » : la taille totale de la mémoire allouée pour la machine virtuelle (en octets)                                                      |
|                            |     - « overhead » : la mémoire sur-alloué (en octets)                                                                                             |
|                            |     - « ballooning », « shared » et « active ».                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « used » est en dessous du seuil WARNING.                                                                     |
|                            |  - Remonte un état WARNING si la métrique « used » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                 |
|                            |  - Remonte un état CRITICAL si la métrique « used » est au dessus du seuil CRITICAL.                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | usage=362747904o;1717986918;1932735283;0;2147483648 size=2147483648o overhead=22743040o ballooning=0o shared=4561920o active=70148096o             |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/5                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  memvm                                                         |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--vm``\             | Nom de la machine virtuelle ciblée                                  |  myvmname                                                      |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\  | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\ | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --vm "$HOSTADDRESS$" -u memvm --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


DATASTORES
''''''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_datastoresvm                                                                                                                 |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation des datastores rattachées à une machine virtuelle. 2 métriques sont renvoyés par datastore :                        |
|                            |   - « riops » : le nombre moyen d'I/O de lectures par seconde                                                                                      |
|                            |   - « wiops » : le nombre moyen d'I/O d'écritures par seconde                                                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si une métrique est en dessous du seuil WARNING.                                                                             |
|                            |  - Remonte un état WARNING si une métrique est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                         |
|                            |  - Remonte un état CRITICAL si une métrique est au dessus du seuil CRITICAL.                                                                       |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | 'riops_LUN1'=0.00iops 'wiops_LUN1'=0.27iops 'riops_LUN2'=20.00iops 'wiops_LUN2'=100.2iops                                                          |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+--------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                 | Description                                                                        | Exemple                                                        |
|                          |                                                                                    |                                                                |
+==========================+====================================================================================+================================================================+
| -u                       | Indicateur à contrôler                                                             |  datastoresvm                                                  |
+--------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--vm``\              | Nom de la machine virtuelle ciblée                                                 |  myvmname                                                      |
+--------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\   | (optionnel – Défaut : aucunes) Seuil warning en ms                                 |  100                                                           |
+--------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\  | (optionnel – Défaut : aucunes) Seuil critique en ms                                |  150                                                           |
+--------------------------+------------------------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................


Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :


+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| WARNING             | 100                            |
+---------------------+--------------------------------+
| CRITICAL            | 150                            |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --vm "$HOSTADDRESS$" -u datastoresvm --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.

VMTOOLS
'''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_toolsvm                                                                                                                      |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle l'état des VMTools rattachées à une machine virtuelle.                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte l'état « WARNING » si les VMTools sont 'toolsold'.                                                                                      |
|                            |  - Remonte l'état « CRITICAL » si les VMTools sont 'toolsnotrunning' ou 'toolsnotinstalled'.                                                       |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    |                                                                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/1                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  toolsvm                                                       |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--vm``\             | Nom de la machine virtuelle ciblée                                  |  myvmname                                                      |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
|                     |                                |
+---------------------+--------------------------------+
|                     |                                |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --vm "$HOSTADDRESS$" -u toolsvm

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


SNAPSHOTS
'''''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_snapshotvm                                                                                                                   |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle la présence et/ou la date de création des snapshots rattachées à une machine virtuelle.                                                   |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  L'état dépend des paramètres du plugin :                                                                                                          |
|                            |    - Si « --warn » spécifié seul : remonte un état WARNING si un snapshost est présent.                                                            |
|                            |    - Si « --crit » spécifié seul : remonte un état CRITICAL si un snapshost est présent.                                                           |
|                            |    - Si « --warn » et « --older XXX » : remonte un état WARNING si un snapshost est présent et la date de création du                              |
|                            |      snapshot le plus ancien est plus vielle que « temps_courant – XXX »                                                                           |
|                            |    - Si « --crit » et « --older XXX » : remonte un état CRITICAL si un snapshost est présent et la date de création du                             |
|                            |      snapshot le plus ancien est plus vielle que « temps_courant – XXX »                                                                           |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    |                                                                                                                                                    |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/1                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut           | Description                                                                              | Exemple                                                        |
|                    |                                                                                          |                                                                |
+====================+==========================================================================================+================================================================+
| -u                 | Indicateur à contrôler                                                                   |  snapshotvm                                                    |
+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--vm``\        | Nom de la machine virtuelle ciblée                                                       |  myvmname                                                      |
+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--warn``\      | (optionnel) Permet de spécifier un état WARNING                                          |                                                                |
+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--crit``\      | (optionnel) Permet de spécifier un état CRITICAL                                         |                                                                |
+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+
| \ ``--older``\     | (optionnel) le temps en secondes du snaphost le plus vieux par rapport au temps courant  | 86400 (snapshot vieux de + 1jour)                              |
+--------------------+------------------------------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».

+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+

Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).

Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| THRESHOLD           | - -warn                        |
+---------------------+--------------------------------+
|                     |                                |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --vm "$HOSTADDRESS$" -u snapshotvm $_SERVICETHRESHOLD$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


Contrôle d'un datastore
```````````````````````

USAGE
'''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_datastoreusage                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation d'un datastore. 2 métriques sont renvoyés :                                                                         |
|                            |  - « used » : l'espace occupé par le datastore (en octets)                                                                                         |
|                            |  - « size » : la taille totale allouée pour le datastore (en octets)                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « used » est en dessous du seuil WARNING.                                                                     |
|                            |  - Remonte un état WARNING si la métrique « used » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                 |
|                            |  - Remonte un état CRITICAL si la métrique « used » est au dessus du seuil CRITICAL.                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | used=506574405632o;;;0;643976658944 size=643976658944o                                                                                             |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 20/5                                                                                                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  datastore-usage                                               |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du datastore ciblé                                              |  dsname                                                        |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\  | (optionnel – Défaut : 80) Seuil warning en pourcentage              |  75                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\ | (optionnel – Défaut : 90) Seuil critique en pourcentage             |  90                                                            |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| DSNAME              |                                |
+---------------------+--------------------------------+
| WARNING             | 80                             |
+---------------------+--------------------------------+
| CRITICAL            | 90                             |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --datastore "$_SERVICEDSNAME$" -u datastore-usage --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


DATASTORE I/O
'''''''''''''

Fiche d'identité
................

+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Nom du plugin**          | check_merethis_vmware_datastorio                                                                                                                   |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Description**            | Contrôle le taux d'utilisation (I/O) d'un datastore. 2 métriques sont renvoyés :                                                                   |
|                            |  - « read_rate » : le taux d'utilisation moyen en lecture par seconde (en b/s)                                                                     |
|                            |  - « write_rate » : la taille d'utilisation moyen en écriture par seconde (en b/s)                                                                 |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Fonctionnement**         |  - Remonte un état OK si la métrique « used » est en dessous du seuil WARNING.                                                                     |
|                            |  - Remonte un état WARNING si la métrique « used » est en dessous du seuil CRITICAL et au dessus du seuil WARNING.                                 |
|                            |  - Remonte un état CRITICAL si la métrique « used » est au dessus du seuil CRITICAL.                                                               |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Métriques renvoyées**    | read_rate=1589248b/s write_rate=14344192b/s                                                                                                        |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+
| **Interval/Retry(min)**    | 5/5                                                                                                                                                |
+----------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------+

Attribut du contrôle
....................

+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| Attribut                | Description                                                         | Exemple                                                        |
|                         |                                                                     |                                                                |
+=========================+=====================================================================+================================================================+
| -u                      | Indicateur à contrôler                                              |  datastore-io                                                  |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -e ou \ ``--esx-host``\ | Nom du datastore ciblé                                              |  dsname                                                        |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -w ou \ ``--warning``\  | (optionnel – Défaut : 80) Seuil warning en kBps                     |  100                                                           |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+
| -c ou \ ``--critical``\ | (optionnel – Défaut : 90) Seuil critique en kBps                    |  200                                                           |
+-------------------------+---------------------------------------------------------------------+----------------------------------------------------------------+

Le plugin a également besoin des informations sur le daemon « centreon-esxd ».


+---------------------+-----------------------------------------------------------------------------+
| Option              | Comportement                                                                |
|                     |                                                                             |
+=====================+=============================================================================+
| -H                  | IP ou adresse du serveur hébergeant « centreon-esxd »                       |
+---------------------+-----------------------------------------------------------------------------+
| -P                  | (optionnel – Défaut : 5700) Port du serveur hébergeant « centreon-esxd »    |
+---------------------+-----------------------------------------------------------------------------+


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :


Création d'un service et/ou modèle de service
.............................................

Aller dans le menu configuration/service ou template, et créer un service et ou modèle de service (basé sur le modèle de service générique).


Définir les macros suivante :

+---------------------+--------------------------------+
| Macro Name          | Macro Value                    |
|                     |                                |
+=====================+================================+
| DSNAME              |                                |
+---------------------+--------------------------------+
| WARNING             | 100                            |
+---------------------+--------------------------------+
| CRITICAL            | 150                            |
+---------------------+--------------------------------+

Création d'une check command
............................

Afin de simplifier l'utilisation de ce contrôle, il est recommandé de créer la check command suivante ::
  
  $USER1$/centreon_esx_client.pl -H "$_HOSTESXDHOST$" -P "$_HOSTESXDPORT$" --vsphere "$_HOSTVCNAME$" --datastore "$_SERVICEDSNAME$" -u datastore-io --warning $_SERVICEWARNING$ --critical $_SERVICECRITICAL$

L'ensemble des attributs sont déjà défini dans le modèle d'hôte et/ou hôte, et modèle de service et/ou service.


