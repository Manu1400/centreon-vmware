============
Exploitation
============

Generals Principles
-------------------

Centreon-esxd is a Perl program in charged to get back VMWare indicators. This program uses the SDK Perl provided by VMWare in order to connect and get back the informations of one (or more) Virtual Center. To do this, it makes a TCP connection with the VirtualCenter.

By default "centreon-esxd" starts at least two processes (named "handle-client" and "handle-vsphere-xxxx") :

*« handle-client »*:
  *Process waiting for requests of "centron-esx-client.pl" clients.*

Steps of operation :

- A client connects.
- The client ask an monitoring indicator on a VirtualCenter.
- The process "handle-client" sends the request to process "handle-vsphere-xxxx".
- A response is sent by "handle-vsphere-xxxx" to "handle-client".
- The process "handle-client" sends the response to the client.

*« handle-vsphere-xxxx »*:
  *Process responsible to connect and to keep opened a session with the VirtualCenter. To ensure quality performance, a cache of datas description is created.*

Then, this process gets back the VMWare indicators creating a subprocess per request.

Centreon-esxd necessitates the utilization of one (or more) VirtualCenter (or ESX).
This is a example of a distributed architecture :

.. image:: ../images/archi.png

Operating mode
--------------

The "centreon-esxd" program only works in "daemon" mode (a client is needed).

Connector configuration
-----------------------

Le daemon « centreon-esxd » possède un fichier de configuration « centreon_esxd.pm » de la forme suivante ::
 
    %centreonesxd_config = (
        vsphere_server => {
                        'default' => {'url' => 'https://vcenter/sdk',
                                     'username' => 'test@test.fr',
                                     'password' => 'xxxx'},
                        }
    );

« vsphere_server » attribute configure VirtualCenter access.

